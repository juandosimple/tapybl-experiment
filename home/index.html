<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Tapybl MicroLearning</title>

    <!-- Bootstrap 5 + Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Nav -->
    <nav class="navbar navbar-dark border-bottom border-dark sticky-top">
      <div class="container feed-wrapper">
        <a class="navbar-brand fw-bold" href="#">TapyblReels</a>
        <div class="d-none d-md-block" style="max-width: 340px; width: 100%">
          <input
            class="form-control form-control-sm bg-dark-subtle border-0"
            placeholder="Search topics"
          />
        </div>
        <ul class="navbar-nav flex-row ms-auto gap-3">
          <li class="nav-item">
            <a class="nav-link" href="#"
              ><i class="bi bi-house-door fs-5"></i
            ></a>
          </li>
          <li class="nav-item">
            <a class="nav-link p-0" href="../profile/"
              ><img
                src="https://i.pravatar.cc/28?img=5"
                class="rounded-circle"
                width="28"
                height="28"
                alt=""
            /></a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Bloque Stories -->
    <div class="insta-stories">
      <div class="insta-story">
        <img src="../assets/img/story-1.jpg" alt="Usuario 1" />
        <!-- <span>Boundless Learning</span> -->
      </div>
      <div class="insta-story">
        <img src="../assets/img/story-2.jpg" alt="Usuario 2" />
        <!-- <span>Boundless Learning</span> -->
      </div>
      <div class="insta-story">
        <img src="../assets/img/story-3.jpg" alt="Usuario 3" />
        <!-- <span>Boundless Learning</span> -->
      </div>
    </div>

    <!-- Feed -->
    <main class="container feed-wrapper my-4">
      <div class="row g-4">
        <div class="col-lg-8">
          <!-- Video card 1 -->
          <article class="vcard">
            <header class="d-flex align-items-center gap-2 p-3">
              <a href="../channel/novamind-institute/">
                <img
                  src="../assets/img/course_one_logo.png"
                  class="rounded-circle"
                  width="40"
                  height="40"
                  alt=""
                />
              </a>
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  <a href="../channel/novamind-institute/"
                    >Importance of sustainability</a
                  >
                </div>
                <small class="text-body-secondary">Law & Sustainability</small>
              </div>
              <button
                class="btn btn-sm btn-link text-body-secondary"
                style="display: none"
              >
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video1.mp4"
              data-user="Law & Sustainability"
              data-caption="Importance of sustainability"
              data-avatar="../assets/img/course_one_logo.png"
              data-questions='[{
              "id":"q1",
              "time":44,
              "type":"single",
              "text":"What is the primary consequence of ignoring sustainability?",
              "options":[
                "Increased economic growth.",
                "Pollution, climate change, and deforestation.",
                "A decrease in global population.",
                "Improved air and water quality."
              ],
              "correct":1
            }]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video1.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"><i class="bi bi-play-fill"></i></span>
            </button>

            <div class="px-3 pt-2 pb-3">
              <!-- <div>Did you know? – Science Fact Friday</div> -->
              <div class="topic-label assessable">Assessable</div>
              <div>
                <!-- <small class="text-body-secondary"
                  >2 hours ago • 1,024 likes</small
                > -->
              </div>
            </div>
          </article>

          <!-- Video card 2 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_one_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Environmental Laws
                </div>
                <small class="text-body-secondary">Law & Sustainability</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video2.mp4"
              data-user="Law & Sustainability"
              data-caption="Environmental Laws"
              data-avatar="../assets/img/course_one_logo.png"
              data-questions='[{
              "id":"q2",
              "time":51,
              "type":"single",
              "text":"Which of the following is NOT a primary goal of environmental laws?",
              "options":[
                "Limiting pollution from factories and cars.",
                "Protecting forests from deforestation.",
                "Promoting unsustainable practices in agriculture.",
                "Encouraging the use of renewable energy."
              ],
              "correct":2
            }]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video2.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"><i class="bi bi-play-fill"></i></span>
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>
                <!-- <div>Choose a math topic to dive into</div> -->
                <div class="topic-label non-assesable">Non Assessable</div>
                <!-- <small class="text-body-secondary">Law & Sustainabilityall> -->
              </div>
            </div>
          </article>

          <!-- Video card 3 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_one_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Global Cooperation
                </div>
                <small class="text-body-secondary">Law & Sustainability</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video3.mp4"
              data-user="Law & Sustainability"
              data-caption="Global Cooperation"
              data-avatar="../assets/img/course_one_logo.png"
              data-questions='[{
                "id":"q3",
                "time":45,
                "type":"single",
                "text":"What is a key reason why international cooperation is essential for addressing environmental challenges?",
                "options":[
                  "It eliminates all disagreements between countries.",
                  "It forces all countries to adopt the same environmental policies.",
                  "It allows countries to share knowledge and resources, learning from each others experiences.",
                  "It ensures that wealthier nations solely fund environmental initiatives in poorer nations."
                ],
                "correct":2
              }]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video3.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"><i class="bi bi-play-fill"></i></span>
            </button>

            <div class="px-3 pt-2 pb-3">
              <!-- <div>Wave–particle duality in 30s</div> -->
              <div class="topic-label non-assesable">Non Assessable</div>
            </div>
          </article>

          <!-- Video card 4 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_one_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Individual and Collective Action
                </div>
                <small class="text-body-secondary">Law & Sustainability</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video4.mp4"
              data-user="Law & Sustainability"
              data-caption="Individual and Collective Action 🌿"
              data-avatar="../assets/img/course_one_logo.png"
              data-questions='[{
                "id":"q4",
                "time":49,
                "type":"single",
                "text":"What is the most effective approach to achieving a sustainable future?",
                "options":[
                  "Relying solely on governmental regulations and laws.",
                  "Focusing on individual actions without community or government involvement.",
                  "Collective action involving individuals, communities, and governments.",
                  "Depending on corporations to self-regulate their environmental impact."
                ],
                "correct":2
              }]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video4.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"><i class="bi bi-play-fill"></i></span>
            </button>

            <div class="px-3 pt-2 pb-3">
              <!-- <div>Photosynthesis — the 10‑second version</div> -->
              <div class="topic-label assessable">Assessable</div>
            </div>
          </article>
        </div>

        <!-- Sidebar -->
        <aside class="col-lg-4 d-none d-lg-block">
          <div class="position-sticky" style="top: 88px">
            <div class="d-flex align-items-center">
              <img
                src="https://i.pravatar.cc/56?img=5"
                class="rounded-circle me-3"
                width="56"
                height="56"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">Learner</div>
                <small class="text-body-secondary">Law & Sustainability</small>
              </div>
            </div>

            <div class="mt-4 text-body-secondary small">© 2025 TapyblReels</div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Fake Fullscreen Overlay -->
    <section class="fshell" id="fshell" aria-hidden="true">
      <div class="fshell__video-wrap" id="fsWrap">
        <video id="fsVideo" playsinline></video>

        <!-- Double‑tap like heart -->
        <div class="dbl-like" id="dblLike">
          <i
            class="bi bi-heart-fill"
            style="font-size: 5rem; color: #ff2e63"
          ></i>
        </div>

        <!-- Top bar -->
        <div class="fshell__topbar">
          <button class="fshell__close" id="fsClose" aria-label="Close">
            <i class="bi bi-x-lg"></i>
          </button>
          <a href="../channel/novamind-institute/">
            <img
              id="fsAvatar"
              src=""
              class="rounded-circle"
              width="32"
              height="32"
              alt=""
            />
          </a>
          <div id="fsUser" class="fw-semibold"></div>
          <div class="ms-auto d-flex align-items-center gap-2">
            <button class="btn btn-sm btn-outline-light">
              <i class="bi bi-three-dots"></i>
            </button>
          </div>
        </div>

        <!-- Bottom info -->
        <div class="fshell__bottom">
          <div class="caption">
            <div class="fw-semibold" id="fsUser2">user</div>
            <div id="fsCaption" class="text-body-secondary">Caption</div>
          </div>
          <div class="progress-ghost mt-2"><i id="fsProgress"></i></div>
        </div>

        <!-- Quiz Overlay -->
        <div class="quiz-shell" id="quizShell" hidden>
          <div class="quiz-card p-3">
            <div class="d-flex align-items-start gap-3">
              <div class="flex-grow-1">
                <div class="quiz-title mb-2" id="quizQuestion">
                  Question goes here
                </div>
                <div id="quizOptions" class="d-flex flex-wrap gap-2"></div>
                <div class="quiz-feedback small mt-2" id="quizFeedback"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- /Quiz Overlay -->
      </div>
    </section>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      /* ===== Dynamic VH fix (mobile safe fullscreen) ===== */
      function setVhUnit() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", vh + "px");
      }
      setVhUnit();
      window.addEventListener("resize", setVhUnit);
      window.addEventListener("orientationchange", setVhUnit);

      /* ===== Elements ===== */
      const fshell = document.getElementById("fshell");
      const fsWrap = document.getElementById("fsWrap");
      const fsVideo = document.getElementById("fsVideo");
      const fsClose = document.getElementById("fsClose");
      const fsUser = document.getElementById("fsUser");
      const fsUser2 = document.getElementById("fsUser2");
      const fsCaption = document.getElementById("fsCaption");
      const fsAvatar = document.getElementById("fsAvatar");
      const fsProgress = document.getElementById("fsProgress");

      /* ===== Quiz ===== */
      const quizShell = document.getElementById("quizShell");
      const quizQ = document.getElementById("quizQuestion");
      const quizOptions = document.getElementById("quizOptions");
      const quizFeedback = document.getElementById("quizFeedback");

      const DEFAULT_QUESTIONS = [
        {
          id: "q1",
          time: 3,
          type: "single",
          text: "What is the primary consequence of ignoring sustainability?",
          options: [
            "Increased economic growth.",
            "Pollution, climate change, and deforestation.",
            "A decrease in global population.",
            "Improved air and water quality.",
          ],
          correct: 1,
        },
        {
          id: "q2",
          time: 14,
          type: "single",
          text: "Which of the following is NOT a primary goal of environmental laws?",
          options: [
            "Limiting pollution from factories and cars.",
            "Protecting forests from deforestation.",
            "Promoting unsustainable practices in agriculture.",
            "Encouraging the use of renewable energy.",
          ],
          correct: 2,
        },
        {
          id: "q3",
          time: 14,
          type: "single",
          text: "What is a key reason why international cooperation is essential for addressing environmental challenges?",
          options: [
            "It eliminates all disagreements between countries.",
            "It forces all countries to adopt the same environmental policies.",
            "It allows countries to share knowledge and resources, learning from each other's experiences.",
            "It ensures that wealthier nations solely fund environmental initiatives in poorer nations.",
          ],
          correct: 3,
        },
        {
          id: "q4",
          time: 14,
          type: "single",
          text: "What is the most effective approach to achieving a sustainable future?",
          options: [
            "Relying solely on governmental regulations and laws.",
            "Focusing on individual actions without community or government involvement.",
            "Collective action involving individuals, communities, and governments.",
            "Depending on corporations to self-regulate their environmental impact.",
          ],
          correct: 3,
        },
      ];

      /* ===== State ===== */
      let savedScrollY = 0;
      let currentBtnEl = null;

      let currentQuestions = [];
      let askedSet = new Set();
      let nextIdx = 0;

      /* ===== Quiz helpers ===== */
      function parseQuestionsFrom(btn) {
        try {
          if (btn && btn.dataset.questions)
            return JSON.parse(btn.dataset.questions);
        } catch (e) {}
        return DEFAULT_QUESTIONS;
      }
      function resetQuizState() {
        askedSet.clear();
        nextIdx = 0;
        hideQuiz();
      }
      function showQuiz(q) {
        quizQ.textContent = q.text || "";
        quizOptions.innerHTML = "";
        if (q.type === "icons") {
          quizOptions.className = "d-flex flex-wrap gap-2 icon-grid";
          (q.options || []).forEach((opt, i) => {
            const card = document.createElement("button");
            card.type = "button";
            card.className = "icon-pick btn btn-transparent text-white";
            card.innerHTML = `<i class="${
              opt.icon || "bi bi-dot"
            }"></i><small>${opt.label || "Option"}</small>`;
            card.addEventListener("click", () => handleAnswer(q, i));
            quizOptions.appendChild(card);
          });
        } else {
          quizOptions.className = "d-flex flex-wrap gap-2";
          (q.options || []).forEach((opt, i) => {
            const label =
              typeof opt === "object" && opt
                ? opt.label || opt.text || `Option ${i + 1}`
                : String(opt);
            const b = document.createElement("button");
            b.className = "btn btn-sm btn-light";
            b.textContent = label;
            b.addEventListener("click", () => handleAnswer(q, i));
            quizOptions.appendChild(b);
          });
        }
        quizFeedback.textContent = "";
        quizFeedback.className = "quiz-feedback small mt-2";
        quizShell.hidden = false;
        fsVideo.pause();
      }
      function hideQuiz() {
        quizShell.hidden = true;
      }

      function handleAnswer(q, chosenIdx) {
  askedSet.add(q.id);

  if (q.type === "branch" || q.type === "icons") {
    const opt = q.options?.[chosenIdx];
    hideQuiz();
    if (opt && typeof opt === "object" && Number.isFinite(opt.seek)) {
      fsVideo.currentTime = Math.max(0, opt.seek);
    }
    fsVideo.play().catch(() => {});
    return;
  }

  if (q.type === "single" && Number.isInteger(q.correct)) {
    // Añadir título arriba
    const title = document.createElement("h1");
    title.textContent = "Correct answer!";
    title.className = "w-100 text-center mb-3 text-success";
    quizOptions.parentNode.insertBefore(title, quizOptions);

    // Resaltar botones
    const buttons = quizOptions.querySelectorAll("button");
    buttons.forEach((btn, idx) => {
      if (idx === q.correct) {
        btn.style.backgroundColor = "green";
        btn.style.color = "white";
      }
      if (idx === chosenIdx && chosenIdx !== q.correct) {
        btn.style.backgroundColor = "red";
        btn.style.color = "white";
      }
      btn.disabled = true;
    });

    // Pausar el video mientras se ve la respuesta
    fsVideo.pause();

    // Reanudar después de 3 segundos
    setTimeout(() => {
      hideQuiz();
      fsVideo.play().catch(() => {});
    }, 3000);

  } else {
    quizFeedback.textContent = "Thanks for voting!";
    quizFeedback.classList.add("ok");
    quizFeedback.classList.remove("err");
    setTimeout(() => {
      hideQuiz();
      fsVideo.play().catch(() => {});
    }, 3000);
  }
}

      function checkQuizTick() {
        if (!currentQuestions.length || nextIdx >= currentQuestions.length)
          return;
        const q = currentQuestions[nextIdx];
        if (askedSet.has(q.id)) {
          nextIdx++;
          return;
        }
        if (fsVideo.currentTime >= (q.time || 0)) {
          showQuiz(q);
          nextIdx++;
        }
      }

      /* ===== UI helpers ===== */
      function setFsUiFromBtn(btn) {
        const { user, caption, avatar } = btn.dataset;
        fsUser.textContent = user || "";
        fsUser2.textContent = user || "";
        fsCaption.textContent = caption || "";
        fsAvatar.src = avatar || "";
        currentQuestions = parseQuestionsFrom(btn).sort(
          (a, b) => (a.time || 0) - (b.time || 0)
        );
        resetQuizState();
      }

      /* ===== Open / Close FS ===== */
      function openFS({
        src,
        user,
        caption,
        avatar,
        startAt = 0,
        btnEl = null,
      }) {
        savedScrollY = window.scrollY;
        document.body.style.top = `-${savedScrollY}px`;
        document.body.style.position = "fixed";
        document.body.style.width = "100%";

        currentBtnEl = btnEl;
        fshell.classList.add("active");
        fshell.setAttribute("aria-hidden", "false");

        setFsUiFromBtn(btnEl || { dataset: { user, caption, avatar } });

        fsVideo.src = src;
        fsVideo.currentTime = startAt;
        fsVideo.muted = false;
        fsVideo.autoplay = true;
        fsVideo.playsInline = true;
        fsVideo.play().catch(() => {});

        updateProgress();
      }
      function closeFS() {
        document.body.style.position = "";
        document.body.style.top = "";
        window.scrollTo(0, savedScrollY);

        fshell.classList.remove("active");
        fshell.setAttribute("aria-hidden", "true");
        fsVideo.pause();
        fsVideo.removeAttribute("src");
        fsVideo.load();

        resetQuizState();
      }

      /* ===== Open handlers (thumbnails) ===== */
      document.querySelectorAll(".open-fs").forEach((btn) => {
        btn.addEventListener("click", () => {
          const { src, user, caption, avatar } = btn.dataset;
          const thumbVideo = btn.querySelector("video");
          const startAt = thumbVideo ? thumbVideo.currentTime : 0;
          openFS({ src, user, caption, avatar, startAt, btnEl: btn });
        });
      });

      /* ===== Close actions ===== */
      fsClose.addEventListener("click", closeFS);
      fshell.addEventListener("click", (e) => {
        if (!fsWrap.contains(e.target) || e.target === fshell) closeFS();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && fshell.classList.contains("active"))
          closeFS();
      });

      /* ===== Progress bar ===== */
      function updateProgress() {
        if (!fshell.classList.contains("active")) return;
        const pct = fsVideo.duration
          ? (fsVideo.currentTime / fsVideo.duration) * 100
          : 0;
        fsProgress.style.width = pct + "%";
        requestAnimationFrame(updateProgress);
      }
      fsVideo.addEventListener("loadedmetadata", updateProgress);
      fsVideo.addEventListener("timeupdate", updateProgress);
      fsVideo.addEventListener("timeupdate", checkQuizTick);

      /* =========================================================================
   DRAG SIMPLE: seguimiento 1:1 + commit por transición CSS
   =======================================================================*/
      let dragging = false;
      let startY = 0,
        lastY = 0,
        lastT = 0;
      let dy = 0,
        vy = 0;
      let isCommitting = false;

      const DEADZONE = 8; // px para empezar
      const THRESHOLD = 56; // px para commit
      const VEL_THRESH = 0.3 / 1000; // px/ms para "flick"
      const RESISTANCE = 0.35; // 0..1 (más alto = más pesado)

      /* Siguiente/Anterior en base al botón actual */
      function neighborBtn(dir) {
        const all = Array.from(document.querySelectorAll(".open-fs"));
        const idx = all.indexOf(currentBtnEl);
        const n = idx + (dir > 0 ? +1 : -1);
        return n >= 0 && n < all.length ? all[n] : null;
      }

      /* Commit animado: el wrap sale con transición CSS; en 'transitionend' swapeamos */
      function commitSwipe(dir) {
        const targetBtn = neighborBtn(dir);
        if (!targetBtn) {
          // fuera de rango → volver a 0
          fsWrap.classList.remove("no-trans");
          fsWrap.style.transform = `translateY(0)`;
          return;
        }

        isCommitting = true;
        fsWrap.classList.remove("no-trans");

        const endY = dir > 0 ? -window.innerHeight : window.innerHeight; // siguiente: hacia arriba
        fsWrap.style.transform = `translateY(${endY}px)`;

        const onEnd = () => {
          fsWrap.removeEventListener("transitionend", onEnd);

          // Swap: set video + UI del destino
          const { src } = targetBtn.dataset;
          fsVideo.pause();
          fsVideo.src = src;
          fsVideo.currentTime = 0;
          fsVideo.muted = false;
          fsVideo.playsInline = true;

          // Para evitar frame negro, arrancamos el play y recién después reseteamos el wrap
          const resume = () => {
            fsVideo.play().catch(() => {});
            // Reset inmediato para el próximo gesto
            fsWrap.classList.add("no-trans");
            fsWrap.style.transform = "translateY(0)";
            // Fuerza reflow y quitamos 'no-trans' para reactivar la transición en el próximo commit
            void fsWrap.offsetHeight;
            fsWrap.classList.remove("no-trans");

            // Actualizamos puntero y UI/questions
            currentBtnEl = targetBtn;
            setFsUiFromBtn(targetBtn);

            isCommitting = false;
          };

          if (fsVideo.readyState >= 2) resume();
          else fsVideo.addEventListener("loadeddata", resume, { once: true });
        };

        fsWrap.addEventListener("transitionend", onEnd);
      }

      /* Drag handlers */
      function onPointerDown(e) {
        if (!fshell.classList.contains("active")) return;
        if (isCommitting) return;
        if (e.pointerType === "mouse" && e.button !== 0) return;

        dragging = true;
        startY = lastY = e.clientY;
        lastT = performance.now();
        dy = 0;
        vy = 0;

        // Durante el drag, sin transición:
        fsWrap.classList.add("no-trans");

        try {
          e.target.setPointerCapture?.(e.pointerId);
        } catch {}
        e.preventDefault();
      }
      function onPointerMove(e) {
        if (!dragging) return;

        const now = performance.now();
        const curY = e.clientY;
        const rawDy = curY - startY;

        if (Math.abs(rawDy) < DEADZONE) {
          lastY = curY;
          lastT = now;
          return;
        }

        const factor =
          1 - Math.min(Math.abs(rawDy) / window.innerHeight, 0.85) * RESISTANCE;
        dy = rawDy * factor;

        const dt = Math.max(1, now - lastT);
        vy = (curY - lastY) / dt; // px/ms
        lastY = curY;
        lastT = now;

        fsWrap.style.transform = `translateY(${dy}px)`;
      }
      function onPointerUp() {
        if (!dragging) return;
        dragging = false;

        const absDy = Math.abs(dy);
        const dir = dy < 0 ? +1 : -1; // arrastrar hacia arriba → siguiente
        const fast = Math.abs(vy) > VEL_THRESH; // “flick”

        if (absDy > THRESHOLD || fast) {
          commitSwipe(dir);
        } else {
          // Volver a 0 con transición CSS
          fsWrap.classList.remove("no-trans");
          fsWrap.style.transform = `translateY(0)`;
        }
      }
      fshell.addEventListener("pointerdown", onPointerDown, { passive: false });
      window.addEventListener("pointermove", onPointerMove, { passive: false });
      window.addEventListener("pointerup", onPointerUp, { passive: true });
      window.addEventListener("pointercancel", onPointerUp, { passive: true });

      /* ===== Auto-next al terminar ===== */
      fsVideo.addEventListener("ended", () => {
        // mismo gesto suave hacia el siguiente
        commitSwipe(+1);
      });
    </script>
  </body>
</html>
