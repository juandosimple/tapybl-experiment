<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Tapybl MicroLearning</title>

    <!-- Bootstrap 5 + Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="../assets/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Nav -->
    <nav class="navbar navbar-dark border-bottom border-dark sticky-top">
      <div class="container feed-wrapper">
        <a class="navbar-brand fw-bold" href="#">TapyblReels</a>
        <div class="d-none d-md-block" style="max-width: 340px; width: 100%">
          <input
            class="form-control form-control-sm bg-dark-subtle border-0"
            placeholder="Search topics"
          />
        </div>
        <ul class="navbar-nav flex-row ms-auto gap-3">
          <li class="nav-item">
            <a class="nav-link" href="#"
              ><i class="bi bi-house-door fs-5"></i
            ></a>
          </li>
          <li class="nav-item">
            <a class="nav-link p-0" href="#"
              ><img
                src="https://i.pravatar.cc/28?img=5"
                class="rounded-circle"
                width="28"
                height="28"
                alt=""
            /></a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Bloque Stories -->
    <div class="insta-stories">
      <div class="insta-story">
        <img src="../assets/img/course_four_logo.png" alt="Usuario 1" />
        <span>TerraBio Research</span>
      </div>
      <div class="insta-story">
        <img src="../assets/img/course_five_logo.png" alt="Usuario 2" />
        <span>Quantum Learning Hub</span>
      </div>
      <div class="insta-story">
        <img src="../assets/img/course_two_logo.png" alt="Usuario 3" />
        <span>Summit Mathematics Center</span>
      </div>
      <div class="insta-story">
        <img src="../assets/img/course_six_logo.png" alt="Usuario 4" />
        <span>Atlas History Guild</span>
      </div>
      <div class="insta-story">
        <img src="../assets/img/course_eleven_logo.png" alt="Usuario 5" />
        <span>Gaia Environmental Studies</span>
      </div>
      <div class="insta-story">
        <img src="../assets/img/course_nine_logo.png" alt="Usuario 6" />
        <span>Orion Coding Camp</span>
      </div>
    </div>

    <!-- Feed -->
    <main class="container feed-wrapper my-4">
      <div class="row g-4">
        <div class="col-lg-8">
          <!-- Video card 1 -->
          <article class="vcard">
            <header class="d-flex align-items-center gap-2 p-3">
              <a href="../channel/novamind-institute/">
                <img
                  src="../assets/img/course_one_logo.png"
                  class="rounded-circle"
                  width="40"
                  height="40"
                  alt=""
                />
              </a>
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  <a href="../channel/novamind-institute/"
                    >NovaMind Institute</a
                  >
                </div>
                <small class="text-body-secondary">Cambridge, England</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video1.mp4"
              data-user="NovaMind Institute"
              data-caption="Did you know? – Science Fact Friday"
              data-avatar="../assets/img/course_one_logo.png"
              data-questions='[
                {"id":"q1a","time":4,"type":"single","text":"What is the chemical formula for water?","options":["H2O","O2","CO2","NaCl"],"correct":0},
                {"id":"q2a","time":16,"type":"poll","text":"Want more science shorts?","options":["Yes","Maybe later"]}
              ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video1.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Did you know? – Science Fact Friday</div>
              <!-- <div class="topic-label">
                <img src="../assets/img/choice_branch.svg" alt="" />Choice
              </div> -->
              <div>
                <!-- <small class="text-body-secondary"
                  >2 hours ago • 1,024 likes</small
                > -->
              </div>
            </div>
          </article>

          <!-- Video card 2 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_two_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Summit Mathematics Center
                </div>
                <small class="text-body-secondary">Buenos Aires, AR</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video2.mp4"
              data-user="Summit Mathematics Center"
              data-caption="Choose a math topic to dive into"
              data-avatar="../assets/img/course_two_logo.png"
              data-questions='[
                {
                  "id":"m2q1",
                  "time":2,
                  "type":"branch",
                  "text":"What are you interested in?",
                  "options":[
                    { "label":"Option A: Algebra",  "seek":5 },
                    { "label":"Option B: Geometry","seek":6 }
                  ]
                }
              ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video2.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>
                <div>Choose a math topic to dive into</div>
                <!-- <div class="topic-label">
                  <img
                    src="../assets/img/challenge_branch.svg"
                    alt=""
                  />Challenge
                </div> -->
                <!-- <small class="text-body-secondary">Yesterday • 542 likes</small> -->
              </div>
            </div>
          </article>

          <!-- Video card 3 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_three_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Aurora Physics Lab
                </div>
                <small class="text-body-secondary">Zurich, CH</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video3.mp4"
              data-user="Aurora Physics Lab"
              data-caption="Wave–particle duality in 30s"
              data-avatar="../assets/img/course_three_logo.png"
              data-questions='[
  {
    "id":"p3icons",
    "time":4,
    "type":"icons",
    "text":"Pick a deep‑dive:",
    "options":[
      { "label":"Energy",       "icon":"bi bi-lightning-charge", "seek":5  },
      { "label":"Double-slit",  "icon":"bi bi-collection-play",  "seek":15 },
      { "label":"Equations",    "icon":"bi bi-braces",           "seek":24 }
    ]
  }
]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video3.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Wave–particle duality in 30s</div>
              <div>
                <small class="text-body-secondary">Today • 312 likes</small>
              </div>
            </div>
          </article>

          <!-- Video card 4 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_four_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  TerraBio Research
                </div>
                <small class="text-body-secondary">Cali, CO</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video4.mp4"
              data-user="TerraBio Research"
              data-caption="Photosynthesis — the 10‑second version 🌿"
              data-avatar="../assets/img/course_four_logo.png"
              data-questions='[
      {"id":"b4q1","time":6,"type":"single","text":"Main pigment is…","options":["Chlorophyll","Carotene","Myoglobin"],"correct":0}
    ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video4.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Photosynthesis — the 10‑second version</div>
              <div>
                <small class="text-body-secondary">Today • 221 likes</small>
              </div>
            </div>
          </article>

          <!-- Video card 5 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_five_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Quantum Learning Hub
                </div>
                <small class="text-body-secondary">Tokyo, JP</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video5.mp4"
              data-user="Quantum Learning Hub"
              data-caption="Qubits vs bits — quick compare"
              data-avatar="../assets/img/course_five_logo.png"
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video5.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Qubits vs bits — quick compare</div>
              <div>
                <small class="text-body-secondary"
                  >2 days ago • 889 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 6 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_six_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Atlas History Guild
                </div>
                <small class="text-body-secondary">Athens, GR</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video6.mp4"
              data-user="Atlas History Guild"
              data-caption="What started the Peloponnesian War?"
              data-avatar="../assets/img/course_six_logo.png"
              data-questions='[
      {"id":"h6q1","time":7,"type":"poll","text":"Want more ancient history shorts?","options":["Yes","No"]}
    ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video6.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>What started the Peloponnesian War?</div>
              <div>
                <small class="text-body-secondary"
                  >3 days ago • 403 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 7 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_seven_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Pixel Arts Academy
                </div>
                <small class="text-body-secondary">Los Angeles, US</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video7.mp4"
              data-user="Pixel Arts Academy"
              data-caption="Color theory in a minute 🎨"
              data-avatar="../assets/img/course_seven_logo.png"
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video7.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Color theory in a minute</div>
              <div>
                <small class="text-body-secondary"
                  >1 week ago • 1,540 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 8 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_eight_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Veritas Language School
                </div>
                <small class="text-body-secondary">Madrid, ES</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video8.mp4"
              data-user="Veritas Language School"
              data-caption="False friends: actually vs actualmente 😅"
              data-avatar="../assets/img/course_eight_logo.png"
              data-questions='[
      {"id":"l8q1","time":5,"type":"single","text":"\"Actually\" in Spanish is…","options":["Actualmente","En realidad","Eventualmente"],"correct":1}
    ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video8.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>False friends: actually vs actualmente</div>
              <div>
                <small class="text-body-secondary"
                  >5 days ago • 763 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 9 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_nine_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Orion Coding Camp
                </div>
                <small class="text-body-secondary">Remote</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video9.mp4"
              data-user="Orion Coding Camp"
              data-caption="Flex vs Grid — when to use each"
              data-avatar="../assets/img/course_nine_logo.png"
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video9.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Flex vs Grid — when to use each</div>
              <div>
                <small class="text-body-secondary"
                  >3 days ago • 1,003 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 10 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_ten_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Horizon Finance Institute
                </div>
                <small class="text-body-secondary">New York, US</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video10.mp4"
              data-user="Horizon Finance Institute"
              data-caption="Compound interest in 20 seconds"
              data-avatar="../assets/img/course_ten_logo.png"
              data-questions='[
      {"id":"f10q1","time":6,"type":"single","text":"Annual rate is 5%, principal grows…","options":["Linearly","Exponentially"],"correct":1}
    ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video10.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Compound interest in 20 seconds</div>
              <div>
                <small class="text-body-secondary">Last week • 678 likes</small>
              </div>
            </div>
          </article>

          <!-- Video card 11 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_eleven_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Gaia Environmental Studies
                </div>
                <small class="text-body-secondary">Wellington, NZ</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video11.mp4"
              data-user="Gaia Environmental Studies"
              data-caption="Carbon footprint — quick reducers"
              data-avatar="../assets/img/course_eleven_logo.png"
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video11.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>Carbon footprint — quick reducers</div>
              <div>
                <small class="text-body-secondary"
                  >2 weeks ago • 245 likes</small
                >
              </div>
            </div>
          </article>

          <!-- Video card 12 -->
          <article class="vcard mt-4">
            <header class="d-flex align-items-center gap-2 p-3">
              <img
                src="../assets/img/course_twelve_logo.png"
                class="rounded-circle"
                width="40"
                height="40"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">
                  Helix Chemistry Club
                </div>
                <small class="text-body-secondary">Paris, FR</small>
              </div>
              <button class="btn btn-sm btn-link text-body-secondary">
                <i class="bi bi-three-dots"></i>
              </button>
            </header>

            <button
              class="vthumb-btn open-fs"
              data-src="../assets/video/video12.mp4"
              data-user="Helix Chemistry Club"
              data-caption="pH scale — fast refresher"
              data-avatar="../assets/img/course_twelve_logo.png"
              data-questions='[
      {"id":"c12q1","time":5,"type":"single","text":"Neutral pH is…","options":["5","7","9"],"correct":1}
    ]'
            >
              <video class="vthumb" preload="metadata" muted playsinline loop>
                <source src="../assets/video/video12.mp4" type="video/mp4" />
              </video>
              <span class="play-badge"
                ><i class="bi bi-play-fill me-1"></i>Watch</span
              >
            </button>

            <div class="px-3 pt-2 pb-3">
              <div>pH scale — fast refresher</div>
              <div>
                <small class="text-body-secondary"
                  >3 weeks ago • 198 likes</small
                >
              </div>
            </div>
          </article>

          <!-- ... (rest of your cards unchanged) ... -->
        </div>

        <!-- Sidebar -->
        <aside class="col-lg-4 d-none d-lg-block">
          <div class="position-sticky" style="top: 88px">
            <div class="d-flex align-items-center">
              <img
                src="https://i.pravatar.cc/56?img=5"
                class="rounded-circle me-3"
                width="56"
                height="56"
                alt=""
              />
              <div class="flex-grow-1">
                <div class="fw-semibold" style="color: #000">Learner</div>
                <small class="text-body-secondary">Level 5</small>
              </div>
            </div>

            <div class="mt-4 text-body-secondary small">© 2025 TapyblReels</div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Fake Fullscreen Overlay -->
    <section class="fshell" id="fshell" aria-hidden="true">
      <div class="fshell__video-wrap" id="fsWrap">
        <video id="fsVideo" playsinline></video>

        <!-- Double‑tap like heart -->
        <div class="dbl-like" id="dblLike">
          <i
            class="bi bi-heart-fill"
            style="font-size: 5rem; color: #ff2e63"
          ></i>
        </div>

        <!-- Top bar -->
        <div class="fshell__topbar">
          <button class="fshell__close" id="fsClose" aria-label="Close">
            <i class="bi bi-x-lg"></i>
          </button>
          <a href="../channel/novamind-institute/">
            <img
              id="fsAvatar"
              src=""
              class="rounded-circle"
              width="32"
              height="32"
              alt=""
            />
          </a>
          <div id="fsUser" class="fw-semibold"></div>
          <div class="ms-auto d-flex align-items-center gap-2">
            <button class="btn btn-sm btn-outline-light">
              <i class="bi bi-three-dots"></i>
            </button>
          </div>
        </div>

        <!-- Bottom info -->
        <div class="fshell__bottom">
          <div class="caption">
            <div class="fw-semibold" id="fsUser2">user</div>
            <div id="fsCaption" class="text-body-secondary">Caption</div>
          </div>
          <div class="progress-ghost mt-2"><i id="fsProgress"></i></div>
        </div>

        <!-- Quiz Overlay -->
        <div class="quiz-shell" id="quizShell" hidden>
          <div class="quiz-card p-3">
            <div class="d-flex align-items-start gap-3">
              <div class="flex-grow-1">
                <div class="quiz-title mb-2" id="quizQuestion">
                  Question goes here
                </div>
                <div id="quizOptions" class="d-flex flex-wrap gap-2"></div>
                <div class="quiz-feedback small mt-2" id="quizFeedback"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- /Quiz Overlay -->
      </div>
    </section>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      /* ===== Dynamic VH fix (mobile safe fullscreen) ===== */
      function setVhUnit() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", vh + "px");
      }
      setVhUnit();
      window.addEventListener("resize", setVhUnit);
      window.addEventListener("orientationchange", setVhUnit);

      const fshell = document.getElementById("fshell");
      const fsVideo = document.getElementById("fsVideo");
      const fsClose = document.getElementById("fsClose");
      const fsUser = document.getElementById("fsUser");
      const fsUser2 = document.getElementById("fsUser2");
      const fsCaption = document.getElementById("fsCaption");
      const fsAvatar = document.getElementById("fsAvatar");
      const fsLikeBtn = document.getElementById("fsLike");
      const likeCountEl = document.getElementById("likeCount");
      const fsProgress = document.getElementById("fsProgress");
      const dblLike = document.getElementById("dblLike");

      // Quiz elements
      const quizShell = document.getElementById("quizShell");
      const quizQ = document.getElementById("quizQuestion");
      const quizOptions = document.getElementById("quizOptions");
      const quizFeedback = document.getElementById("quizFeedback");

      // Default questions if a video doesn't provide data-questions
      const DEFAULT_QUESTIONS = [
        {
          id: "q1",
          time: 3,
          type: "single",
          text: "What is the chemical formula for water?",
          options: ["H2O", "O2", "CO2", "NaCl"],
          correct: 0,
        },
        {
          id: "q2",
          time: 14,
          type: "poll",
          text: "Do you want more content like this?",
          options: ["Yes", "Not now"],
        },
      ];

      let lastTap = 0;
      let liked = false;
      let savedScrollY = 0;

      // Quiz state
      let currentQuestions = [];
      let askedSet = new Set();
      let nextIdx = 0;

      let currentBtnEl = null; // stores the .open-fs button that opened fullscreen

      function parseQuestionsFrom(btn) {
        try {
          if (btn && btn.dataset.questions)
            return JSON.parse(btn.dataset.questions);
        } catch (e) {}
        return DEFAULT_QUESTIONS;
      }

      function resetQuizState() {
        askedSet.clear();
        nextIdx = 0;
        hideQuiz();
      }

      function showQuiz(q) {
        quizQ.textContent = q.text || "";
        quizOptions.innerHTML = "";

        // ICONS MODE
        if (q.type === "icons") {
          quizOptions.className = "d-flex flex-wrap gap-2"; // reset
          quizOptions.classList.add("icon-grid");
          (q.options || []).forEach((opt, i) => {
            const card = document.createElement("button");
            card.type = "button";
            card.className = "icon-pick btn btn-transparent text-white";
            card.innerHTML = `
        <i class="${opt.icon || "bi bi-dot"}"></i>
        <small>${opt.label || "Option"}</small>
      `;
            card.addEventListener("click", () => handleAnswer(q, i));
            quizOptions.appendChild(card);
          });
        } else {
          // DEFAULT (text buttons)
          quizOptions.className = "d-flex flex-wrap gap-2";
          (q.options || []).forEach((opt, i) => {
            const label =
              typeof opt === "object" && opt
                ? opt.label || opt.text || `Option ${i + 1}`
                : String(opt);
            const b = document.createElement("button");
            b.className = "btn btn-sm btn-light";
            b.textContent = label;
            b.addEventListener("click", () => handleAnswer(q, i));
            quizOptions.appendChild(b);
          });
        }

        quizFeedback.textContent = "";
        quizFeedback.className = "quiz-feedback small mt-2";
        quizShell.hidden = false;
        fsVideo.pause();
      }

      function hideQuiz() {
        quizShell.hidden = true;
      }

      function handleAnswer(q, chosenIdx) {
        askedSet.add(q.id);

        // ==== Branching: jump to time and resume
        // Branching & Icons both SEEK
        if (q.type === "branch" || q.type === "icons") {
          const opt = q.options?.[chosenIdx];
          hideQuiz();
          if (opt && typeof opt === "object" && Number.isFinite(opt.seek)) {
            fsVideo.currentTime = Math.max(0, opt.seek);
          }
          fsVideo.play().catch(() => {});
          return;
        }

        // Regular quiz/poll flow
        let resumeDelay = 800;
        if (q.type === "single" && Number.isInteger(q.correct)) {
          if (chosenIdx === q.correct) {
            quizFeedback.textContent = "Correct!";
            quizFeedback.classList.add("ok");
            quizFeedback.classList.remove("err");
          } else {
            quizFeedback.textContent = "Not quite!";
            quizFeedback.classList.add("err");
            quizFeedback.classList.remove("ok");
          }
        } else {
          quizFeedback.textContent = "Thanks for voting!";
          quizFeedback.classList.remove("err");
          quizFeedback.classList.add("ok");
        }

        setTimeout(() => {
          hideQuiz();
          fsVideo.play().catch(() => {});
        }, resumeDelay);
      }

      function checkQuizTick() {
        if (!currentQuestions.length || nextIdx >= currentQuestions.length)
          return;
        const q = currentQuestions[nextIdx];
        if (askedSet.has(q.id)) {
          nextIdx++;
          return;
        }
        if (fsVideo.currentTime >= (q.time || 0)) {
          showQuiz(q);
          nextIdx++;
        }
      }

      function openFS({
        src,
        user,
        caption,
        avatar,
        startAt = 0,
        btnEl = null,
      }) {
        // Lock scroll
        savedScrollY = window.scrollY;
        document.body.style.top = `-${savedScrollY}px`;
        document.body.style.position = "fixed";
        document.body.style.width = "100%";
        currentBtnEl = btnEl;
        fshell.classList.add("active");
        fshell.setAttribute("aria-hidden", "false");

        // Populate UI
        fsUser.textContent = user;
        fsUser2.textContent = user;
        fsCaption.textContent = caption || "";
        fsAvatar.src = avatar || "";

        // Prepare video
        fsVideo.src = src;
        fsVideo.currentTime = startAt;
        fsVideo.muted = false;
        fsVideo.autoplay = true;
        fsVideo.playsInline = true;
        fsVideo.play().catch(() => {});

        // Reset likes
        // liked = false;
        // likeCountEl.textContent = "1.0k";
        // fsLikeBtn.querySelector("i").className = "bi bi-heart";

        // Prepare questions for this video
        currentQuestions = parseQuestionsFrom(btnEl);
        currentQuestions.sort((a, b) => (a.time || 0) - (b.time || 0));
        resetQuizState();

        updateProgress();
      }

      function closeFS() {
        // Unlock scroll
        document.body.style.position = "";
        document.body.style.top = "";
        window.scrollTo(0, savedScrollY);

        fshell.classList.remove("active");
        fshell.setAttribute("aria-hidden", "true");
        fsVideo.pause();
        fsVideo.removeAttribute("src");
        fsVideo.load();

        // Reset quiz overlay
        resetQuizState();
      }

      // Open handlers
      document.querySelectorAll(".open-fs").forEach((btn) => {
        btn.addEventListener("click", () => {
          const src = btn.dataset.src;
          const user = btn.dataset.user;
          const caption = btn.dataset.caption;
          const avatar = btn.dataset.avatar;

          const thumbVideo = btn.querySelector("video");
          const startAt = thumbVideo ? thumbVideo.currentTime : 0;

          openFS({ src, user, caption, avatar, startAt, btnEl: btn });
        });
      });

      // Close actions
      fsClose.addEventListener("click", closeFS);
      fshell.addEventListener("click", (e) => {
        const wrap = document.getElementById("fsWrap");
        if (!wrap.contains(e.target) || e.target === fshell) closeFS();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && fshell.classList.contains("active"))
          closeFS();
      });

      // Like toggle (button)
      // fsLikeBtn.addEventListener("click", () => {
      //   liked = !liked;
      //   fsLikeBtn.querySelector("i").className = liked
      //     ? "bi bi-heart-fill"
      //     : "bi bi-heart";
      //   fsLikeBtn.style.background = liked
      //     ? "rgba(255,46,99,.6)"
      //     : "rgba(0,0,0,.45)";
      //   const n =
      //     parseInt((likeCountEl.textContent || "").replace(/\D/g, ""), 10) ||
      //     1000;
      //   likeCountEl.textContent = (
      //     liked ? n + 1 : Math.max(0, n - 1)
      //   ).toLocaleString();
      // });

      // Double‑tap to like with heart pop
      // fsVideo.addEventListener("click", () => {
      //   const now = Date.now();
      //   if (now - lastTap < 300) {
      //     liked = true;
      //     fsLikeBtn.querySelector("i").className = "bi bi-heart-fill";
      //     fsLikeBtn.style.background = "rgba(255,46,99,.6)";
      //     dblLike.classList.add("show");
      //     setTimeout(() => dblLike.classList.remove("show"), 400);
      //   }
      //   lastTap = now;
      // });

      // Progress bar loop
      function updateProgress() {
        if (!fshell.classList.contains("active")) return;
        const pct = fsVideo.duration
          ? (fsVideo.currentTime / fsVideo.duration) * 100
          : 0;
        fsProgress.style.width = pct + "%";
        requestAnimationFrame(updateProgress);
      }
      fsVideo.addEventListener("loadedmetadata", updateProgress);
      fsVideo.addEventListener("timeupdate", updateProgress);
      fsVideo.addEventListener("timeupdate", checkQuizTick);

      fsVideo.addEventListener("ended", () => {
        const allBtns = Array.from(document.querySelectorAll(".open-fs"));
        const idx = allBtns.indexOf(currentBtnEl);

        if (idx >= 0 && idx < allBtns.length - 1) {
          const nextBtn = allBtns[idx + 1];
          transitionToBtn(nextBtn, +1); // swipe up con rebote
        } else {
          closeFS();
        }
      });

      let wheelBusy = false;
      const WHEEL_COOLDOWN_MS = 450; // feel free to tweak
      const DELTA_THRESHOLD = 30; // ignore tiny touchpad jitters

      fshell.addEventListener(
        "wheel",
        (e) => {
          if (!fshell.classList.contains("active")) return;

          // prevent the page from scrolling behind the fake fullscreen
          e.preventDefault();

          if (wheelBusy) return;
          const dy = e.deltaY || 0;
          if (Math.abs(dy) < DELTA_THRESHOLD) return;

          wheelBusy = true;
          if (dy > 0) {
            // scroll down → next
            goRelativeVideo(+1);
          } else {
            // scroll up → previous
            goRelativeVideo(-1);
          }
          setTimeout(() => {
            wheelBusy = false;
          }, WHEEL_COOLDOWN_MS);
        },
        { passive: false }
      );

      /* ===== Swipe helper con video temporal ===== */
      let isTransitioning = false;

      /* Clona "liviano": arma un pane con video + textos (user/caption) del botón destino */
      function buildSwipePane(targetBtn) {
        const pane = document.createElement("div");
        pane.className = "fswipe-pane fswipe-anim";

        // VIDEO
        const v = document.createElement("video");
        v.className = "fswipe-pane__video";
        v.setAttribute("playsinline", "");
        v.autoplay = true;
        v.muted = false; // si querés “crossfade” silencioso poné true
        v.src = targetBtn.dataset.src;
        v.currentTime = 0;

        // TOP BAR (minimal)
        const top = document.createElement("div");
        top.className = "fswipe-pane__topbar";
        const topUser = document.createElement("div");
        topUser.className = "fw-semibold";
        topUser.textContent = targetBtn.dataset.user || "";
        top.appendChild(topUser);

        // BOTTOM (caption)
        const bottom = document.createElement("div");
        bottom.className = "fswipe-pane__bottom";
        const cap1 = document.createElement("div");
        cap1.className = "fw-semibold";
        cap1.textContent = targetBtn.dataset.user || "";
        const cap2 = document.createElement("div");
        cap2.className = "text-body-secondary";
        cap2.textContent = targetBtn.dataset.caption || "";
        bottom.appendChild(cap1);
        bottom.appendChild(cap2);

        pane.appendChild(v);
        pane.appendChild(top);
        pane.appendChild(bottom);

        return { pane, video: v };
      }

      function setFsUiFromBtn(btn) {
        // Actualizá los textos/imagen reales del FS (tu UI original)
        const { user, caption, avatar } = btn.dataset;
        fsUser.textContent = user || "";
        fsUser2.textContent = user || "";
        fsCaption.textContent = caption || "";
        fsAvatar.src = avatar || "";

        // Preguntas
        currentQuestions = parseQuestionsFrom(btn).sort(
          (a, b) => (a.time || 0) - (b.time || 0)
        );
        resetQuizState();
      }

      /** dir: +1 siguiente (swipe up), -1 anterior (swipe down) */
      function transitionToBtn(targetBtn, dir) {
        if (!targetBtn || isTransitioning) return;
        isTransitioning = true;

        const wrap = document.getElementById("fsWrap");

        // Construimos pane entrante
        const { pane, video: incomingVid } = buildSwipePane(targetBtn);
        pane.classList.add(
          dir > 0 ? "fswipe-enter-from-bottom" : "fswipe-enter-from-top"
        );

        // Estado base del contenedor actual (sale)
        wrap.classList.add("fswipe-anim");
        wrap.style.willChange = "transform";

        // Insertar pane por encima
        fshell.appendChild(pane); // dentro del overlay, arriba de todo

        // Forzar reflow para aplicar animaciones
        void pane.offsetHeight;

        // Disparar animaciones: entra pane con rebote, sale wrap
        pane.classList.add(dir > 0 ? "fswipe-bounce-up" : "fswipe-bounce-down");
        wrap.classList.add(
          dir > 0 ? "fswipe-exit-to-top" : "fswipe-exit-to-bottom"
        );

        // Al terminar la animación del WRAP saliente:
        const onWrapEnd = () => {
          wrap.removeEventListener("transitionend", onWrapEnd);

          // 1) Switchear el video REAL a la nueva src y tiempo actual del pane
          const t = incomingVid.currentTime || 0;
          fsVideo.pause();
          fsVideo.src = targetBtn.dataset.src;
          fsVideo.currentTime = t;
          fsVideo.muted = false;
          fsVideo.play().catch(() => {});

          // 2) Actualizar UI real + preguntas
          currentBtnEl = targetBtn;
          setFsUiFromBtn(targetBtn);

          // 3) Resetear clases/estilos
          wrap.classList.remove(
            "fswipe-anim",
            "fswipe-exit-to-top",
            "fswipe-exit-to-bottom"
          );
          wrap.style.transform = "";
          wrap.style.opacity = "";
          wrap.style.willChange = "";

          // 4) Remover pane temporal
          incomingVid.pause();
          pane.remove();

          isTransitioning = false;
        };
        wrap.addEventListener("transitionend", onWrapEnd, { once: true });
      }

      /* Sobrescribimos tu goRelativeVideo para usar la animación nueva */
      function goRelativeVideo(step) {
        const allBtns = Array.from(document.querySelectorAll(".open-fs"));
        const idx = allBtns.indexOf(currentBtnEl);
        const nextIdx = idx + step;

        if (nextIdx >= 0 && nextIdx < allBtns.length) {
          const nextBtn = allBtns[nextIdx];
          transitionToBtn(nextBtn, step > 0 ? +1 : -1);
        }
      }

      document.addEventListener("keydown", (e) => {
        if (!fshell.classList.contains("active")) return;
        if (e.key === "ArrowDown" || e.key === "PageDown") {
          e.preventDefault();
          goRelativeVideo(+1);
        }
        if (e.key === "ArrowUp" || e.key === "PageUp") {
          e.preventDefault();
          goRelativeVideo(-1);
        }
      });
    </script>
  </body>
</html>
